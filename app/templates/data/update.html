{% extends "base.html" %} {% block header %}
<h1 class="text-3xl pl-64">{% block title %}Update Data{% endblock %}</h1>
{% endblock %} {% block content %}
<div class="flex justify-center items-start">
  <div class="overflow-x-auto w-3/4">
    <table class="table">
      <thead>
        <tr>
          <th>Dataset Name</th>
          <th>Created</th>
          <th>Creator</th>
          <th>Location Type</th>
          <th>Invenio</th>
          <th>Project 1</th>
          <th>Project 2</th>
          <th>UID</th>
        </tr>
      </thead>

      <tbody hx-target="closest tr" hx-swap="outerHTML">
        {% for data in data_entries %}
        <tr id="{{ data['data_id'] }}" class="hover main-detail">
          <td>{{data['data_name']}}</td>
          <td>{{data['created']}}</td>
          <td>
            {{ data['email'] + " " + data['firstname'] + " " + data['lastname']
            }}
          </td>
          <td>{{ data['data_location_type'] }}</td>
          <td>{{ data['invenio'] }}</td>
          <td>{{ data['project1_name'] }}</td>
          <td>{{ data['project2_name'] }}</td>
          <td>{{ data['uid'] }}</td>
          <td>
            <button type="button" hx-get="/data/{{ data['data_id']}}/edit">
              edit
            </button>
            <button type="button" hx-delete="/data/{{ data['data_id']}}">
              remove
            </button>
          </td>
        </tr>
        <tr class="border-t-0 expanded-detail">
          <td colspan="3" class="max-w-64 maxh-64">
            Description: {{ data['data_description'] }}
          </td>
          <td colspan="4">Location: {{ data['data_location'] }}</td>
          <td>
            <a
              href="{{ url_for('data.download_readme', data_id=data['data_id']) }}"
              ><button class="btn btn-sm">Download UID</button></a
            >
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<script>
  var expandedRow = [];
  var expandedDetailRows = document.querySelectorAll(".expanded-detail");
  expandedDetailRows.forEach(function hideDetails(row) {
    row.style.display = "none";
  });

  var mainDetailRows = document.querySelectorAll(".main-detail");
  mainDetailRows.forEach(function addShowEventListener(row) {
    row.addEventListener("click", function showDetails() {
      var nextRow = this.nextElementSibling;
      toggleRow(this.id, nextRow);
    });
  });

  function toggleRow(id, nextRow) {
    if (expandedRow.includes(id)) {
      expandedRow.splice(expandedRow.indexOf(id), 1);
      nextRow.style.display = "none";
    } else {
      expandedRow.push(id);
      nextRow.style.display = "";
    }
  }
</script>

{% endblock content %}
